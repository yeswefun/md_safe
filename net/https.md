

https的工作流程

    非对称加密，公钥和私钥
        公钥是通过私钥生成的
        私钥只能自己持有，公钥可以对外分发
        公钥加密只能由私钥解密
        私钥加密只能由公钥解密

    客户端请求服务端公钥
    服务端响应公钥
    客户端拿到公钥，审核
    客户端随机生成一个密钥，并使用公钥对其加密，并发送到服务端
    服务端用私钥解密得到密钥，服务端使用密钥加密响应数据，并返回给客户端
    客户端使用密钥解密加密数据得到响应数据

    注: android P 禁止明文传输




中间人攻击

    客户端请求服务端公钥
    charles拦截请求，并将代理客户端服务端公钥
    服务端返回公钥
    charles得到服务端的公钥，并向客户端返回charles自己的公钥
    客户端验证证书，信任证书，随机生成密钥，并使用charles的公钥进行加密，然后发送到服务端
    charles拦截请求，并使用charles自己的私钥解开加密数据，得到客户端的密钥，使用服务端的公钥对密钥进行加密并发送到服务端
    服务端使用私钥解密加密数据得到密钥，使用密钥加密响应数据并返回
    charles得到服务端的加密数据，使用密钥解开加密数据，得到响应数据，然后将加密的数据返回给客户端


如何防御中间人攻击


